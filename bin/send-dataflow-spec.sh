#!/bin/bash
SIMULATION_DIR=`pwd`
curl -X POST http://localhost:22000/pde/dataflow \
    -H "Content-Type: application/text" \
    --data 'dataflow(clothing)
            program(ClothingApp::deduplication(),'$SIMULATION_DIR')
            dataset(ideduplication, , )
            extractor(ideduplication,ideduplication,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status},{numeric;text;text;numeric;text;numeric;text})
            dataset(odeduplication, , )
            extractor(odeduplication,odeduplication,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status},{numeric;text;text;numeric;text;numeric;text})
            transformation(deduplication,{ideduplication},{odeduplication},{ClothingApp::deduplication()})
            program(ClothingApp::europe(),'$SIMULATION_DIR')
            dataset(oeurope, , )
            extractor(oeurope,oeurope,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status},{numeric;text;text;numeric;text;numeric;text})
            transformation(europe,{odeduplication},{oeurope},{ClothingApp::europe()})
            program(ClothingApp::united_states(),'$SIMULATION_DIR')
            dataset(ounited_states, , )
            extractor(ounited_states,ounited_states,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status},{numeric;text;text;numeric;text;numeric;text})
            transformation(united_states,{odeduplication},{ounited_states},{ClothingApp::united_states()})
            program(ClothingApp::union(),'$SIMULATION_DIR')
            dataset(ounion, , )
            extractor(ounion,ounion,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status},{numeric;text;text;numeric;text;numeric;text})
            transformation(union,{oeurope;ounited_states},{ounion},{ClothingApp::union()})
            program(ClothingApp::cartesian_product(),'$SIMULATION_DIR')
            dataset(icloth_item, , )
            extractor(icloth_item,icloth_item,EXTRACTION,PROGRAM,{clothid;description},{numeric;text})
            dataset(ocartesian_product, , )
            extractor(ocartesian_product,ocartesian_product,EXTRACTION,PROGRAM,{customerid;country;continent;age;gender;children;status;clothid;description},{numeric;text;text;numeric;text;numeric;text;numeric;text})
            transformation(cartesian_product,{ounion;icloth_item},{ocartesian_product},{ClothingApp::cartesian_product()})
            program(ClothingApp::prediction(),'$SIMULATION_DIR')
            dataset(ibuying_pattern, , )
            extractor(ibuying_pattern,ibuying_pattern,EXTRACTION,PROGRAM,{buyingpatternid;clothid;country;continent;age;gender;children;status},{numeric;numeric;text;text;numeric;text;numeric;text})
            dataset(oprediction, , )
            extractor(oprediction,oprediction,EXTRACTION,PROGRAM,{customerid;buyingpatternid;clothid;probability},{numeric;numeric;numeric;numeric})
            transformation(prediction,{ocartesian_product;ibuying_pattern},{oprediction},{ClothingApp::prediction()})
            program(ClothingApp::aggregation(),'$SIMULATION_DIR')
            dataset(oaggregation, , )
            extractor(oaggregation,oaggregation,EXTRACTION,PROGRAM,{clothid;quantity},{numeric;numeric})
            transformation(aggregation,{oprediction},{oaggregation},{ClothingApp::aggregation()})'
sleep 3
clear